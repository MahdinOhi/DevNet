{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon" />
  <!-- Icon - IconMonster -->
  <link rel="stylesheet" href="https://cdn.iconmonstr.com/1.3.0/css/iconmonstr-iconic-font.min.css" />
  <!-- Mumble UI -->
  <link rel="stylesheet" href="{% static 'uikit/styles/uikit.css' %}" />
  <!-- Dev Search UI -->
  <link rel="stylesheet" href="{% static 'styles/app.css' %}" />

  <title>DevNet - Connect with Developers!</title>
</head>

<body>
  <!-- Header -->
<header class="header">
  <div class="container">
    <a href="/" class="header__logo">
      <img src="{% static 'images/logo.png' %}" alt="DevNet Logo" />
    </a>
    
    <nav class="header__nav">
      <input type="checkbox" id="responsive-menu" />
      <label for="responsive-menu" class="toggle-menu">
        <div class="toggle-menu__lines"></div>
      </label>
      <ul class="header__menu">
        <li class="header__menuItem"><a href="{% url 'index' %}">Home</a></li>
        <li class="header__menuItem"><a href="{% url 'index' %}">Developers</a></li>
        <li class="header__menuItem"><a href="{% url 'projects' %}">Projects</a></li>
        <li class="header__menuItem"><a href="">About Us</a></li>
      </ul>
    </nav>
    
    <div class="header__actions">
      <!-- Theme Toggle -->
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <svg class="theme-toggle__icon theme-toggle__icon--sun" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="1.5"/>
          <path d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <svg class="theme-toggle__icon theme-toggle__icon--moon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <!-- User Account Icon -->
      <a href="{% url 'account' %}" class="header__account" aria-label="User Account">
       <img width="24" height="24" src="https://img.icons8.com/material-rounded/24/1A1A1A/user-male-circle.png" alt="user-male-circle"/>
      </a>
      
      <!-- Inbox Icon -->
      <a href="{% url 'inbox' %}" class="header__inbox" aria-label="Inbox">
       <img width="27" height="27" src="https://img.icons8.com/sf-regular-filled/48/1A1A1A/secured-letter.png" alt="secured-letter"/>
      </a>
    </div>
  </div>
</header>

<!-- Hero Section -->
<section class="hero-section">
  <div class="container">
    <div class="glass">
      <div class="hero-section__box">
        <h1>Find the Perfect <span class="highlight">Developer</span> for Your Project</h1>
        <p>Join the most innovative developer community and showcase your skills to the world</p>
      </div>
      
      <div class="hero-section__search">
        <form class="form" method="get" action="{% url 'index' %}" id="searchForm">
          <div class="form__field">
            <label for="formInput#search">Search Developers</label>
            <input 
              class="input input--text"
              id="formInput#search"
              type="text"
              name="search"
              value="{{ search_query }}"
              placeholder="Search Developers, Projects & tags"
            />
          </div>
          
          <!-- Advanced Search Filters -->
          <div class="advanced-search" id="advancedSearch" style="display: none;">
            <div class="search-filters-grid">
              <div class="form__field">
                <label for="location">üìç Location</label>
                <input 
                  class="input input--text"
                  id="location"
                  type="text"
                  name="location"
                  value="{{ location_filter }}"
                  placeholder="Enter location (e.g., New York, Remote)"
                  autocomplete="off"
                />
                <div class="autocomplete-suggestions" id="locationSuggestions"></div>
              </div>
              
              <div class="form__field">
                <label for="experience">üíº Experience Level</label>
                <select class="input input--text" id="experience" name="experience">
                  <option value="">All Experience Levels</option>
                  {% for value, label in experience_levels %}
                    <option value="{{ value }}" {% if experience_filter == value %}selected{% endif %}>{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <div class="form__field">
                <label for="tech_stack">‚ö° Technology Stack</label>
                <input 
                  class="input input--text"
                  id="tech_stack"
                  type="text"
                  name="tech_stack"
                  value="{{ tech_stack_filter }}"
                  placeholder="e.g., Python, React, Django"
                  autocomplete="off"
                />
                <div class="autocomplete-suggestions" id="techStackSuggestions"></div>
              </div>
              
              <div class="form__field">
                <label for="availability">üü¢ Availability Status</label>
                <select class="input input--text" id="availability" name="availability">
                  <option value="">All Availability</option>
                  {% for value, label in availability_statuses %}
                    <option value="{{ value }}" {% if availability_filter == value %}selected{% endif %}>{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <div class="form__field form__field--wide">
                <label for="skills">üõ†Ô∏è Skills (comma-separated)</label>
                <input 
                  class="input input--text"
                  id="skills"
                  type="text"
                  name="skills"
                  value="{{ skill_filter }}"
                  placeholder="e.g., Python, JavaScript, React, Machine Learning"
                  autocomplete="off"
                />
                <div class="autocomplete-suggestions" id="skillSuggestions"></div>
                <small class="form-help">Use commas to separate multiple skills</small>
              </div>
              
              <div class="form__field">
                <label for="operator">üîç Search Operator</label>
                <select class="input input--text" id="operator" name="operator">
                  <option value="AND" {% if search_operator == 'AND' %}selected{% endif %}>AND (all skills must match)</option>
                  <option value="OR" {% if search_operator == 'OR' %}selected{% endif %}>OR (any skill can match)</option>
                  <option value="NOT" {% if search_operator == 'NOT' %}selected{% endif %}>NOT (exclude these skills)</option>
                </select>
                <small class="form-help">Choose how to combine multiple skills</small>
              </div>
            </div>
            
            <!-- Quick Filter Tags -->
            <div class="quick-filters">
              <h4>Quick Filters</h4>
              <div class="filter-tags">
                <button type="button" class="filter-tag" data-filter="experience:junior">Junior Developers</button>
                <button type="button" class="filter-tag" data-filter="experience:senior">Senior Developers</button>
                <button type="button" class="filter-tag" data-filter="availability:open">Open to Work</button>
                <button type="button" class="filter-tag" data-filter="tech_stack:Python">Python Developers</button>
                <button type="button" class="filter-tag" data-filter="tech_stack:React">React Developers</button>
                <button type="button" class="filter-tag" data-filter="tech_stack:Machine Learning">ML Engineers</button>
              </div>
            </div>
          </div>
          
          <div class="search-buttons">
            <button class="btn btn--sub btn--lg" type="submit">Search</button>
            <button class="btn btn--outline btn--lg" type="button" id="toggleAdvanced">Advanced Filters</button>
            <button class="btn btn--outline btn--sm" type="button" id="clearFilters">Clear All</button>
          </div>
        </form>
      </div>
      
      <div class="hero-section__cta">
        {% if request.user.username %}
          <a href="{% url 'account' %}" class="btn btn--sub btn--lg">My Account</a>
          <a href="{% url 'logout' %}" class="btn btn--outline btn--lg">Log Out</a>
        {% else %}
          <a href="{% url 'login' %}" class="btn btn--sub btn--lg">Login</a>
          <a href="{% url 'login' %}" class="btn btn--outline btn--lg">Sign Up</a>
        {% endif %}
      </div>
    </div>
  </div>
</section>
    <!-- Search Result: DevList -->
    <section class="devlist">
      <div class="container">
        <div class="devlist__header">
          <h2 class="devlist__title">
            <span class="devlist__icon">üåü</span>
            {% if search_query or location_filter or experience_filter or tech_stack_filter or availability_filter or skill_filter %}
              Search Results
            {% else %}
              Featured Developers
            {% endif %}
          </h2>
          {% if search_query or location_filter or experience_filter or tech_stack_filter or availability_filter or skill_filter %}
            <div class="search-results-info">
              <p class="search-results-count">
                Found <strong>{{ users.paginator.count }}</strong> developer{{ users.paginator.count|pluralize }}
                {% if search_query %}matching "{{ search_query }}"{% endif %}
              </p>
              {% if users.paginator.count > 0 %}
                <div class="active-filters">
                  {% if search_query %}
                    <span class="active-filter">Search: "{{ search_query }}"</span>
                  {% endif %}
                  {% if location_filter %}
                    <span class="active-filter">üìç {{ location_filter }}</span>
                  {% endif %}
                  {% if experience_filter %}
                    <span class="active-filter">üíº {{ experience_filter|title }}</span>
                  {% endif %}
                  {% if tech_stack_filter %}
                    <span class="active-filter">‚ö° {{ tech_stack_filter }}</span>
                  {% endif %}
                  {% if availability_filter %}
                    <span class="active-filter">üü¢ {{ availability_filter|title }}</span>
                  {% endif %}
                  {% if skill_filter %}
                    <span class="active-filter">üõ†Ô∏è {{ skill_filter }}</span>
                  {% endif %}
                </div>
              {% endif %}
            </div>
          {% endif %}
        </div>

        {% if users %}
          <div class="grid grid--three">
            {% for user in users %}
              <div class="column card">
                <div class="dev">
                  <a href="{% url 'profile' user.username %}" class="card__body">
                    <div class="dev__profile">
                      <img class="avatar avatar--md" src="{{ user.account.avatar.url }}" alt="image" />
                      <div class="dev__meta">
                        <h3>{{ user.first_name }} {{ user.last_name }}</h3>
                        <h5>{{ user.account.summary }}</h5>
                        <div class="dev__badges">
                          <span class="dev__badge dev__badge--{{ user.account.experience_level }}">
                            {{ user.account.get_experience_level_display }}
                          </span>
                          <span class="dev__badge dev__badge--{{ user.account.availability_status }}">
                            {{ user.account.get_availability_status_display }}
                          </span>
                        </div>
                      </div>
                    </div>
                    <p class="dev__info">{{ user.account.about }}</p>
                    <div class="dev__skills">
                        {% for skill in user.account.skill_set.all %}
                          <span class="tag tag--pill tag--main">
                            <small>{{ skill.name }}</small>
                          </span>
                        {% endfor %}
                    </div>
                    {% if user.account.technology_stack %}
                      <div class="dev__tech-stack">
                        <strong>Tech Stack:</strong> {{ user.account.technology_stack }}
                      </div>
                    {% endif %}
                    {% if user.account.location %}
                      <div class="dev__location">
                        <strong>üìç</strong> {{ user.account.location }}
                      </div>
                    {% endif %}
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="no-results">
            <div class="no-results__content">
              <div class="no-results__icon">üîç</div>
              <h3 class="no-results__title">No developers found</h3>
              <p class="no-results__message">
                {% if search_query or location_filter or experience_filter or tech_stack_filter or availability_filter or skill_filter %}
                  Try adjusting your search criteria or filters to find more developers.
                {% else %}
                  No developers are currently available. Check back later!
                {% endif %}
              </p>
              {% if search_query or location_filter or experience_filter or tech_stack_filter or availability_filter or skill_filter %}
                <div class="no-results__suggestions">
                  <h4>Suggestions:</h4>
                  <ul>
                    <li>Try broader search terms</li>
                    <li>Remove some filters</li>
                    <li>Check spelling</li>
                    <li>Try different keywords</li>
                  </ul>
                </div>
                <button class="btn btn--outline" onclick="document.getElementById('clearFilters').click()">
                  Clear All Filters
                </button>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </section>

    <div class="pagination">
      <ul class="container">
      {% if users.has_previous %}
        <li><a href="{% url 'index' %}?page={{ users.previous_page_number }}" class="btn">&#10094; Prev</a></li>
      {% else %}
          <li><a class="btn btn--disabled">&#10094; Prev</a></li>
      {% endif %}

          {% for page in users.paginator.page_range %}
            {% if users.number == page %}
                <li><a href="{% url 'index' %}?page={{ page }}" class="btn btn--sub">{{ page }}</a></li>
            {% else %}
                <li><a href="{% url 'index' %}?page={{ page }}" class="btn">{{ page }}</a></li>
            {% endif %}
          {% endfor %}

      {% if users.has_next %}
        <li><a href="{% url 'index' %}?page={{ users.next_page_number }}" class="btn">Next &#10095;</a></li>
      {% else %}
          <li><a class="btn btn--disabled">Next &#10095;</a></li>
      {% endif %}
      </ul>
    </div>


    <footer class="footer">
  <div class="container">
    <div class="footer__content">
      <div class="footer__logo">
        <a href="/">
          <img src="{% static 'images/logo.svg' %}" alt="DevSearch Logo" />
        </a>
      </div>

      
    </div>

    <div class="footer__copyright">
      <p>&copy; 2025 DevSearch. All rights reserved.</p>
    </div>
  </div>
</footer>
  </main>
  <script>
    // Header Scroll Effect - Add glow when scrolling
    document.addEventListener('DOMContentLoaded', function() {
      const header = document.querySelector('.header');
      let scrollThreshold = 50; // Pixels to scroll before effect triggers

      // Add scroll event listener
      window.addEventListener('scroll', function() {
        if (window.scrollY > scrollThreshold) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      });

      // Theme Toggle Functionality
      const themeToggle = document.getElementById('theme-toggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          document.body.classList.toggle('dark-theme');
          
          // Save theme preference to localStorage
          const isDark = document.body.classList.contains('dark-theme');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // Load saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
          document.body.classList.add('dark-theme');
        }
      }

      // Advanced Search Functionality
      const toggleAdvanced = document.getElementById('toggleAdvanced');
      const advancedSearch = document.getElementById('advancedSearch');
      const clearFilters = document.getElementById('clearFilters');
      
      if (toggleAdvanced) {
        toggleAdvanced.addEventListener('click', function() {
          if (advancedSearch.style.display === 'none') {
            advancedSearch.style.display = 'block';
            toggleAdvanced.textContent = 'Hide Filters';
          } else {
            advancedSearch.style.display = 'none';
            toggleAdvanced.textContent = 'Advanced Filters';
          }
        });
      }
      
      if (clearFilters) {
        clearFilters.addEventListener('click', function() {
          document.getElementById('searchForm').reset();
          window.location.href = '{% url "index" %}';
        });
      }

      // Autocomplete functionality
      function setupAutocomplete(inputId, suggestionsId, apiEndpoint) {
        const input = document.getElementById(inputId);
        const suggestions = document.getElementById(suggestionsId);
        let timeout;

        if (input && suggestions) {
          input.addEventListener('input', function() {
            clearTimeout(timeout);
            const query = this.value.trim();
            
            if (query.length < 2) {
              suggestions.innerHTML = '';
              suggestions.style.display = 'none';
              return;
            }

            timeout = setTimeout(() => {
              fetch(`${apiEndpoint}?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                  const items = data[Object.keys(data)[0]]; // Get the first property value
                  if (items && items.length > 0) {
                    suggestions.innerHTML = items.map(item => 
                      `<div class="suggestion-item" onclick="selectSuggestion('${inputId}', '${item.replace(/'/g, "\\'")}')">${item}</div>`
                    ).join('');
                    suggestions.style.display = 'block';
                  } else {
                    suggestions.innerHTML = '';
                    suggestions.style.display = 'none';
                  }
                })
                .catch(error => {
                  console.error('Autocomplete error:', error);
                  suggestions.innerHTML = '';
                  suggestions.style.display = 'none';
                });
            }, 300);
          });

          // Hide suggestions when clicking outside
          document.addEventListener('click', function(e) {
            if (!input.contains(e.target) && !suggestions.contains(e.target)) {
              suggestions.style.display = 'none';
            }
          });
        }
      }

      // Setup autocomplete for different fields
      setupAutocomplete('location', 'locationSuggestions', '{% url "location-autocomplete" %}');
      setupAutocomplete('skills', 'skillSuggestions', '{% url "skill-autocomplete" %}');
      setupAutocomplete('tech_stack', 'techStackSuggestions', '{% url "tech-stack-autocomplete" %}');

      // Global function to select suggestion
      window.selectSuggestion = function(inputId, value) {
        document.getElementById(inputId).value = value;
        document.getElementById(inputId + 'Suggestions').style.display = 'none';
      };

      // Quick filter functionality
      const filterTags = document.querySelectorAll('.filter-tag');
      filterTags.forEach(tag => {
        tag.addEventListener('click', function() {
          const filterData = this.getAttribute('data-filter');
          const [filterType, filterValue] = filterData.split(':');
          
          // Set the appropriate form field
          switch(filterType) {
            case 'experience':
              document.getElementById('experience').value = filterValue;
              break;
            case 'availability':
              document.getElementById('availability').value = filterValue;
              break;
            case 'tech_stack':
              document.getElementById('tech_stack').value = filterValue;
              break;
            case 'skills':
              document.getElementById('skills').value = filterValue;
              break;
          }
          
          // Show advanced search if hidden
          if (advancedSearch.style.display === 'none') {
            advancedSearch.style.display = 'block';
            toggleAdvanced.textContent = 'Hide Filters';
          }
          
          // Submit the form
          document.getElementById('searchForm').submit();
        });
      });

      // Enhanced search with real-time suggestions
      function enhanceSearchInput() {
        const searchInput = document.getElementById('formInput#search');
        if (searchInput) {
          searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            if (query.length > 2) {
              // Show search suggestions or perform live search
              console.log('Searching for:', query);
            }
          });
        }
      }

      // Initialize enhanced search
      enhanceSearchInput();

      // Save search preferences
      function saveSearchPreferences() {
        const form = document.getElementById('searchForm');
        const formData = new FormData(form);
        const searchParams = new URLSearchParams();
        
        for (let [key, value] of formData.entries()) {
          if (value.trim()) {
            searchParams.set(key, value);
          }
        }
        
        localStorage.setItem('searchPreferences', searchParams.toString());
      }

      // Load search preferences
      function loadSearchPreferences() {
        const saved = localStorage.getItem('searchPreferences');
        if (saved) {
          const params = new URLSearchParams(saved);
          params.forEach((value, key) => {
            const element = document.querySelector(`[name="${key}"]`);
            if (element) {
              element.value = value;
            }
          });
        }
      }

      // Save preferences on form change
      const form = document.getElementById('searchForm');
      if (form) {
        form.addEventListener('change', saveSearchPreferences);
        form.addEventListener('input', saveSearchPreferences);
      }

      // Load preferences on page load
      loadSearchPreferences();
    });
</script>
</body>
</html>